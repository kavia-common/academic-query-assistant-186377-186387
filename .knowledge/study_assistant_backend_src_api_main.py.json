{"is_source_file": true, "format": "Python", "description": "This file defines the main FastAPI application for the Academic Query Assistant backend API. It sets up endpoints for health checks, session management, chat interactions, and retrieving chat histories, integrating with session storage, an AI client, and request validation. It manages session IDs via headers, processes user questions, and interacts with an external AI service to generate responses.", "external_files": ["./config.py", "./deps.py", "./schemas.py", "./services/openai_client.py", "./services/session_store.py"], "external_methods": ["get_settings", "get_session_store", "ChatRequest.model_validate", "openai_client.get_ai_client"], "published": ["health_check", "create_session", "chat", "get_history"], "classes": [], "methods": [{"name": "Tuple[str,bool] _ensure_session_id(header_session_id: Optional[str])", "description": "Ensures a session ID is present; generates a new UUID if missing or blank.", "scope": "", "scopeKind": ""}, {"name": "Any _sanitize_val_error_detail(detail: Any)", "description": "Sanitizes ValidationError details, converting exceptions to strings for JSON serialization.", "scope": "", "scopeKind": ""}, {"name": "health_check()", "description": "Health check endpoint to verify the service is running.", "scope": "", "scopeKind": ""}, {"name": "dict create_session()", "description": "Creates and returns a new session ID.", "scope": "", "scopeKind": ""}, {"name": "Optional[str] _validate_question(text: str)", "description": "Performs heuristic validation on the user question.", "scope": "", "scopeKind": ""}, {"name": "List[ChatMessage] _history_to_messages(history: List[dict])", "description": "Converts stored message history into AI chat message format.", "scope": "", "scopeKind": ""}, {"name": "ChatResponse chat( payload: dict, response: Response, x_session_id: Optional[str] = Header(default=None, alias=\"X-Session-Id\"), store: InMemorySessionStore = Depends(get_session_store), )", "description": "Handles user questions, validates them, interacts with AI client, and returns generated answers.", "scope": "", "scopeKind": ""}, {"name": "HistoryResponse get_history( response: Response, x_session_id: Optional[str] = Header(default=None, alias=\"X-Session-Id\"), store: InMemorySessionStore = Depends(get_session_store), )", "description": "Retrieves the message history for a session.", "scope": "", "scopeKind": ""}, {"name": "Any _safe(val: Any)", "scope": "_sanitize_val_error_detail", "scopeKind": "function", "description": "unavailable"}], "calls": ["get_settings", "get_session_store", "ChatRequest.model_validate", "openai_client.get_ai_client", "client.chat", "store.append_message", "store.get_history"], "search-terms": ["FastAPI", "chat endpoint", "session management", "AI client interaction", "InMemorySessionStore", "health check", "X-Session-Id", "question validation", "HistoryResponse", "ChatResponse"], "state": 2, "file_id": 2, "knowledge_revision": 35, "git_revision": "d170f368e5cff3ccf682f1cb44de855afe7de113", "revision_history": [{"9": "635d1b304f05b294535f5b9aeb1db1b143057fe8"}, {"16": "05758792f7148e9fec3292e373fa11173032f9a3"}, {"21": "05758792f7148e9fec3292e373fa11173032f9a3"}, {"22": "20d3da011ff0beadda17df0177f4951415fbb890"}, {"30": "20d3da011ff0beadda17df0177f4951415fbb890"}, {"31": "e48d461d1902d74dc7104163695289d465209013"}, {"33": "f8266ebcb31766f0f88e1643e930d029541cf40f"}, {"34": "67883c3ab48970b1717982fe520aac5d934685e6"}, {"35": "d170f368e5cff3ccf682f1cb44de855afe7de113"}], "ctags": [{"_type": "tag", "name": "_ensure_session_id", "path": "/home/kavia/workspace/code-generation/academic-query-assistant-186377-186387/study_assistant_backend/src/api/main.py", "pattern": "/^def _ensure_session_id(header_session_id: Optional[str]) -> Tuple[str, bool]:$/", "language": "Python", "typeref": "typename:Tuple[str,bool]", "kind": "function", "signature": "(header_session_id: Optional[str])"}, {"_type": "tag", "name": "_history_to_messages", "path": "/home/kavia/workspace/code-generation/academic-query-assistant-186377-186387/study_assistant_backend/src/api/main.py", "pattern": "/^def _history_to_messages(history: List[dict]) -> List[ChatMessage]:$/", "language": "Python", "typeref": "typename:List[ChatMessage]", "kind": "function", "signature": "(history: List[dict])"}, {"_type": "tag", "name": "_safe", "path": "/home/kavia/workspace/code-generation/academic-query-assistant-186377-186387/study_assistant_backend/src/api/main.py", "pattern": "/^    def _safe(val: Any) -> Any:$/", "file": true, "language": "Python", "typeref": "typename:Any", "kind": "function", "signature": "(val: Any)", "scope": "_sanitize_val_error_detail", "scopeKind": "function"}, {"_type": "tag", "name": "_sanitize_val_error_detail", "path": "/home/kavia/workspace/code-generation/academic-query-assistant-186377-186387/study_assistant_backend/src/api/main.py", "pattern": "/^def _sanitize_val_error_detail(detail: Any) -> Any:$/", "language": "Python", "typeref": "typename:Any", "kind": "function", "signature": "(detail: Any)"}, {"_type": "tag", "name": "_validate_question", "path": "/home/kavia/workspace/code-generation/academic-query-assistant-186377-186387/study_assistant_backend/src/api/main.py", "pattern": "/^def _validate_question(text: str) -> Optional[str]:$/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "function", "signature": "(text: str)"}, {"_type": "tag", "name": "app", "path": "/home/kavia/workspace/code-generation/academic-query-assistant-186377-186387/study_assistant_backend/src/api/main.py", "pattern": "/^app = FastAPI($/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "chat", "path": "/home/kavia/workspace/code-generation/academic-query-assistant-186377-186387/study_assistant_backend/src/api/main.py", "pattern": "/^def chat($/", "language": "Python", "typeref": "typename:ChatResponse", "kind": "function", "signature": "( payload: dict, response: Response, x_session_id: Optional[str] = Header(default=None, alias=\"X-Session-Id\"), store: InMemorySessionStore = Depends(get_session_store), )"}, {"_type": "tag", "name": "create_session", "path": "/home/kavia/workspace/code-generation/academic-query-assistant-186377-186387/study_assistant_backend/src/api/main.py", "pattern": "/^def create_session() -> dict:$/", "language": "Python", "typeref": "typename:dict", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "get_history", "path": "/home/kavia/workspace/code-generation/academic-query-assistant-186377-186387/study_assistant_backend/src/api/main.py", "pattern": "/^def get_history($/", "language": "Python", "typeref": "typename:HistoryResponse", "kind": "function", "signature": "( response: Response, x_session_id: Optional[str] = Header(default=None, alias=\"X-Session-Id\"), store: InMemorySessionStore = Depends(get_session_store), )"}, {"_type": "tag", "name": "health_check", "path": "/home/kavia/workspace/code-generation/academic-query-assistant-186377-186387/study_assistant_backend/src/api/main.py", "pattern": "/^def health_check():$/", "language": "Python", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "openai_client_module", "path": "/home/kavia/workspace/code-generation/academic-query-assistant-186377-186387/study_assistant_backend/src/api/main.py", "pattern": "/^from .services import openai_client as openai_client_module$/", "language": "Python", "kind": "unknown", "nameref": "unknown:openai_client"}], "hash": "91a7d7c24b1d415bbcc03ba5b3cbc290", "format-version": 4, "code-base-name": "study_assistant_backend", "filename": "study_assistant_backend/src/api/main.py", "fields": [{"name": "app = FastAPI(", "scope": "", "scopeKind": "", "description": "unavailable"}]}