{"is_source_file": true, "format": "Python", "description": "This file is a FastAPI backend API implementation for the 'Academic Query Assistant'. It provides endpoints for health check, session management, chat messaging with AI integration, and chat history retrieval. It uses Pydantic models and includes middleware for CORS configuration.", "external_files": ["./config", "./deps", "./schemas", "./services/openai_client", "./services/session_store"], "external_methods": ["get_settings", "get_session_store", "ChatRequest.model_validate", "get_ai_client"], "published": ["app"], "classes": [], "methods": [{"name": "health_check()", "description": "Health check endpoint to confirm the service is running.", "scope": "", "scopeKind": ""}, {"name": "dict create_session()", "description": "Generates and returns a new unique session ID for chat sessions.", "scope": "", "scopeKind": ""}, {"name": "Tuple[str,bool] _ensure_session_id(header_session_id: Optional[str])", "description": "Helper function to validate or generate a session ID based on header input.", "scope": "", "scopeKind": ""}, {"name": "Any _sanitize_val_error_detail(detail: Any)", "description": "Sanitizes validation error details to ensure JSON serialization, including converting exceptions to strings.", "scope": "", "scopeKind": ""}, {"name": "ChatResponse chat( payload: dict, response: Response, x_session_id: Optional[str] = Header(default=None, alias=\"X-Session-Id\"), store: InMemorySessionStore = Depends(get_session_store), )", "description": "Main endpoint to handle user questions, obtain AI responses, manage session history, and handle errors.", "scope": "", "scopeKind": ""}, {"name": "HistoryResponse get_history( response: Response, x_session_id: Optional[str] = Header(default=None, alias=\"X-Session-Id\"), store: InMemorySessionStore = Depends(get_session_store), )", "description": "Retrieve the chat history for a given session, creating a new empty session if required.", "scope": "", "scopeKind": ""}, {"name": "List[ChatMessage] _history_to_messages(history: List[dict])", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "Any _safe(val: Any)", "scope": "_sanitize_val_error_detail", "scopeKind": "function", "description": "unavailable"}, {"name": "Optional[str] _validate_question(text: str)", "scope": "", "scopeKind": "", "description": "unavailable"}], "calls": ["get_ai_client", "get_settings", "get_session_store", "ChatRequest.model_validate", "client.chat", "store.append_message", "store.get_history"], "search-terms": ["FastAPI", "AI chat backend", "session management", "chat history", "openai integration", "CORS middleware", "session ID header", "academic question assistant"], "state": 2, "file_id": 2, "knowledge_revision": 30, "git_revision": "20d3da011ff0beadda17df0177f4951415fbb890", "revision_history": [{"9": "635d1b304f05b294535f5b9aeb1db1b143057fe8"}, {"16": "05758792f7148e9fec3292e373fa11173032f9a3"}, {"21": "05758792f7148e9fec3292e373fa11173032f9a3"}, {"22": "20d3da011ff0beadda17df0177f4951415fbb890"}, {"30": "20d3da011ff0beadda17df0177f4951415fbb890"}], "ctags": [{"_type": "tag", "name": "_ensure_session_id", "path": "/home/kavia/workspace/code-generation/academic-query-assistant-186377-186387/study_assistant_backend/src/api/main.py", "pattern": "/^def _ensure_session_id(header_session_id: Optional[str]) -> Tuple[str, bool]:$/", "language": "Python", "typeref": "typename:Tuple[str,bool]", "kind": "function", "signature": "(header_session_id: Optional[str])"}, {"_type": "tag", "name": "_history_to_messages", "path": "/home/kavia/workspace/code-generation/academic-query-assistant-186377-186387/study_assistant_backend/src/api/main.py", "pattern": "/^def _history_to_messages(history: List[dict]) -> List[ChatMessage]:$/", "language": "Python", "typeref": "typename:List[ChatMessage]", "kind": "function", "signature": "(history: List[dict])"}, {"_type": "tag", "name": "_safe", "path": "/home/kavia/workspace/code-generation/academic-query-assistant-186377-186387/study_assistant_backend/src/api/main.py", "pattern": "/^    def _safe(val: Any) -> Any:$/", "file": true, "language": "Python", "typeref": "typename:Any", "kind": "function", "signature": "(val: Any)", "scope": "_sanitize_val_error_detail", "scopeKind": "function"}, {"_type": "tag", "name": "_sanitize_val_error_detail", "path": "/home/kavia/workspace/code-generation/academic-query-assistant-186377-186387/study_assistant_backend/src/api/main.py", "pattern": "/^def _sanitize_val_error_detail(detail: Any) -> Any:$/", "language": "Python", "typeref": "typename:Any", "kind": "function", "signature": "(detail: Any)"}, {"_type": "tag", "name": "_validate_question", "path": "/home/kavia/workspace/code-generation/academic-query-assistant-186377-186387/study_assistant_backend/src/api/main.py", "pattern": "/^def _validate_question(text: str) -> Optional[str]:$/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "function", "signature": "(text: str)"}, {"_type": "tag", "name": "app", "path": "/home/kavia/workspace/code-generation/academic-query-assistant-186377-186387/study_assistant_backend/src/api/main.py", "pattern": "/^app = FastAPI($/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "chat", "path": "/home/kavia/workspace/code-generation/academic-query-assistant-186377-186387/study_assistant_backend/src/api/main.py", "pattern": "/^def chat($/", "language": "Python", "typeref": "typename:ChatResponse", "kind": "function", "signature": "( payload: dict, response: Response, x_session_id: Optional[str] = Header(default=None, alias=\"X-Session-Id\"), store: InMemorySessionStore = Depends(get_session_store), )"}, {"_type": "tag", "name": "create_session", "path": "/home/kavia/workspace/code-generation/academic-query-assistant-186377-186387/study_assistant_backend/src/api/main.py", "pattern": "/^def create_session() -> dict:$/", "language": "Python", "typeref": "typename:dict", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "get_history", "path": "/home/kavia/workspace/code-generation/academic-query-assistant-186377-186387/study_assistant_backend/src/api/main.py", "pattern": "/^def get_history($/", "language": "Python", "typeref": "typename:HistoryResponse", "kind": "function", "signature": "( response: Response, x_session_id: Optional[str] = Header(default=None, alias=\"X-Session-Id\"), store: InMemorySessionStore = Depends(get_session_store), )"}, {"_type": "tag", "name": "health_check", "path": "/home/kavia/workspace/code-generation/academic-query-assistant-186377-186387/study_assistant_backend/src/api/main.py", "pattern": "/^def health_check():$/", "language": "Python", "kind": "function", "signature": "()"}], "hash": "eb2eb845e0c32edf33e2db34ffbfa1e0", "format-version": 4, "code-base-name": "study_assistant_backend", "filename": "study_assistant_backend/src/api/main.py", "fields": [{"name": "app = FastAPI(", "scope": "", "scopeKind": "", "description": "unavailable"}]}