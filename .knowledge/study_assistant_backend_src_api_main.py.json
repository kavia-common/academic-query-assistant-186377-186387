{"is_source_file": true, "format": "Python", "description": "This Python source file implements a FastAPI-based backend API for an academic query assistant. It includes endpoints for health checks, session creation, sending chat questions for AI responses, and retrieving chat history. It manages sessions in-memory and interacts with an AI client service and configuration management.", "external_files": ["./config.py", "./deps.py", "./schemas.py", "./services/openai_client.py", "./services/session_store.py"], "external_methods": ["get_settings", "get_session_store", "ChatRequest.model_validate", "get_ai_client"], "published": ["app"], "classes": [{"name": "InMemorySessionStore", "description": "Class managing session messages stored in memory, with methods to append messages and retrieve history."}, {"name": "ChatRequest", "description": "Pydantic model for incoming chat request payload, including question, context, max_history, session_id."}, {"name": "ChatResponse", "description": "Pydantic model for responding with AI answer and session_id."}, {"name": "HistoryResponse", "description": "Pydantic model for returning session history."}, {"name": "Message", "description": "Schema defining a chat message with role, content, and timestamp."}], "methods": [{"name": "Tuple[str,bool] _ensure_session_id(header_session_id: Optional[str])", "description": "Ensures a valid session ID, generating one if not provided.", "scope": "", "scopeKind": ""}, {"name": "Any _sanitize_val_error_detail(detail: Any)", "description": "Sanitizes ValidationError details for JSON serialization, converting exceptions to strings.", "scope": "", "scopeKind": ""}, {"name": "health_check()", "description": "Health check endpoint to verify the service is running.", "scope": "", "scopeKind": ""}, {"name": "dict create_session()", "description": "Creates and returns a new session ID.", "scope": "", "scopeKind": ""}, {"name": "Optional[str] _validate_question(text: str)", "description": "Performs heuristic validation on input questions for length and clarity.", "scope": "", "scopeKind": ""}, {"name": "List[ChatMessage] _history_to_messages(history: List[dict])", "description": "Converts stored message history to AI client message format.", "scope": "", "scopeKind": ""}, {"name": "ChatResponse chat( payload: dict, response: Response, x_session_id: Optional[str] = Header(default=None, alias=\"X-Session-Id\"), store: InMemorySessionStore = Depends(get_session_store), )", "description": "Main chat endpoint: validates input, manages session, interacts with AI client, and returns answer.", "scope": "", "scopeKind": ""}, {"name": "HistoryResponse get_history( response: Response, x_session_id: Optional[str] = Header(default=None, alias=\"X-Session-Id\"), store: InMemorySessionStore = Depends(get_session_store), )", "description": "Retrieves chat history for a session, creating an empty one if none exists.", "scope": "", "scopeKind": ""}, {"name": "Any _safe(val: Any)", "scope": "_sanitize_val_error_detail", "scopeKind": "function", "description": "unavailable"}], "calls": ["get_settings", "get_session_store", "ChatRequest.model_validate", "get_ai_client", "store.append_message", "store.get_history", "client.chat"], "search-terms": ["FastAPI API backend", "session management", "AI chat endpoint", "in-memory session store", "academic query assistant", "health check route", "chat history retrieval", "session ID creation"], "state": 2, "file_id": 2, "knowledge_revision": 31, "git_revision": "e48d461d1902d74dc7104163695289d465209013", "revision_history": [{"9": "635d1b304f05b294535f5b9aeb1db1b143057fe8"}, {"16": "05758792f7148e9fec3292e373fa11173032f9a3"}, {"21": "05758792f7148e9fec3292e373fa11173032f9a3"}, {"22": "20d3da011ff0beadda17df0177f4951415fbb890"}, {"30": "20d3da011ff0beadda17df0177f4951415fbb890"}, {"31": "e48d461d1902d74dc7104163695289d465209013"}], "ctags": [{"_type": "tag", "name": "_ensure_session_id", "path": "/home/kavia/workspace/code-generation/academic-query-assistant-186377-186387/study_assistant_backend/src/api/main.py", "pattern": "/^def _ensure_session_id(header_session_id: Optional[str]) -> Tuple[str, bool]:$/", "language": "Python", "typeref": "typename:Tuple[str,bool]", "kind": "function", "signature": "(header_session_id: Optional[str])"}, {"_type": "tag", "name": "_history_to_messages", "path": "/home/kavia/workspace/code-generation/academic-query-assistant-186377-186387/study_assistant_backend/src/api/main.py", "pattern": "/^def _history_to_messages(history: List[dict]) -> List[ChatMessage]:$/", "language": "Python", "typeref": "typename:List[ChatMessage]", "kind": "function", "signature": "(history: List[dict])"}, {"_type": "tag", "name": "_safe", "path": "/home/kavia/workspace/code-generation/academic-query-assistant-186377-186387/study_assistant_backend/src/api/main.py", "pattern": "/^    def _safe(val: Any) -> Any:$/", "file": true, "language": "Python", "typeref": "typename:Any", "kind": "function", "signature": "(val: Any)", "scope": "_sanitize_val_error_detail", "scopeKind": "function"}, {"_type": "tag", "name": "_sanitize_val_error_detail", "path": "/home/kavia/workspace/code-generation/academic-query-assistant-186377-186387/study_assistant_backend/src/api/main.py", "pattern": "/^def _sanitize_val_error_detail(detail: Any) -> Any:$/", "language": "Python", "typeref": "typename:Any", "kind": "function", "signature": "(detail: Any)"}, {"_type": "tag", "name": "_validate_question", "path": "/home/kavia/workspace/code-generation/academic-query-assistant-186377-186387/study_assistant_backend/src/api/main.py", "pattern": "/^def _validate_question(text: str) -> Optional[str]:$/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "function", "signature": "(text: str)"}, {"_type": "tag", "name": "app", "path": "/home/kavia/workspace/code-generation/academic-query-assistant-186377-186387/study_assistant_backend/src/api/main.py", "pattern": "/^app = FastAPI($/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "chat", "path": "/home/kavia/workspace/code-generation/academic-query-assistant-186377-186387/study_assistant_backend/src/api/main.py", "pattern": "/^def chat($/", "language": "Python", "typeref": "typename:ChatResponse", "kind": "function", "signature": "( payload: dict, response: Response, x_session_id: Optional[str] = Header(default=None, alias=\"X-Session-Id\"), store: InMemorySessionStore = Depends(get_session_store), )"}, {"_type": "tag", "name": "create_session", "path": "/home/kavia/workspace/code-generation/academic-query-assistant-186377-186387/study_assistant_backend/src/api/main.py", "pattern": "/^def create_session() -> dict:$/", "language": "Python", "typeref": "typename:dict", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "get_history", "path": "/home/kavia/workspace/code-generation/academic-query-assistant-186377-186387/study_assistant_backend/src/api/main.py", "pattern": "/^def get_history($/", "language": "Python", "typeref": "typename:HistoryResponse", "kind": "function", "signature": "( response: Response, x_session_id: Optional[str] = Header(default=None, alias=\"X-Session-Id\"), store: InMemorySessionStore = Depends(get_session_store), )"}, {"_type": "tag", "name": "health_check", "path": "/home/kavia/workspace/code-generation/academic-query-assistant-186377-186387/study_assistant_backend/src/api/main.py", "pattern": "/^def health_check():$/", "language": "Python", "kind": "function", "signature": "()"}], "hash": "eb2eb845e0c32edf33e2db34ffbfa1e0", "format-version": 4, "code-base-name": "study_assistant_backend", "filename": "study_assistant_backend/src/api/main.py", "fields": [{"name": "app = FastAPI(", "scope": "", "scopeKind": "", "description": "unavailable"}]}