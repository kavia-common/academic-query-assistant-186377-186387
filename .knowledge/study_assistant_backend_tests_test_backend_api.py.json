{"is_source_file": true, "format": "Python", "description": "This is a test file for the backend API of the study assistant project, containing pytest-based tests for endpoints such as health check, session creation, chat validation, chat completion, history retrieval, and error handling.", "external_files": ["src.api.main"], "external_methods": ["fastapi.testclient.TestClient"], "published": ["test_health_check_ok", "test_session_get_returns_uuid", "test_chat_validation_errors", "test_chat_success_with_auto_created_session_and_mock_ai", "test_history_returns_messages_for_session", "test_openai_error_results_in_502"], "classes": [], "methods": [{"name": "force_mock_ai(monkeypatch)", "description": "Fixture to ensure tests run without a real OpenAI API key by clearing 'OPENAI_API_KEY' from environment variables.", "scope": "", "scopeKind": ""}, {"name": "TestClient client()", "description": "Fixture that provides a FastAPI TestClient instance to test the app.", "scope": "", "scopeKind": ""}, {"name": "test_health_check_ok(client: TestClient)", "description": "Tests the health check endpoint returns a status 200 and correct message.", "scope": "", "scopeKind": ""}, {"name": "test_session_get_returns_uuid(client: TestClient)", "description": "Tests that the session creation endpoint returns a UUID formatted session_id.", "scope": "", "scopeKind": ""}, {"name": "test_chat_validation_errors(client: TestClient, question: str, expected_msg_fragment: str)", "description": "Parametrized test for various invalid chat questions to ensure proper validation errors.", "scope": "", "scopeKind": ""}, {"name": "test_chat_success_with_auto_created_session_and_mock_ai(client: TestClient)", "description": "Tests successful chat endpoint creation, including session auto-creation and mock AI response structure.", "scope": "", "scopeKind": ""}, {"name": "test_history_returns_messages_for_session(client: TestClient)", "description": "Tests retrieval of message history for a given session ID.", "scope": "", "scopeKind": ""}, {"name": "test_openai_error_results_in_502(client: TestClient)", "description": "Simulates an upstream error from AI client and verifies the API responds with a 502 status.", "scope": "", "scopeKind": ""}, {"name": "str chat(self, messages, model: Optional[str] = None)", "scope": "test_openai_error_results_in_502.DummyAIClient", "scopeKind": "class", "description": "unavailable"}], "calls": ["src.api.main.app", "fastapi.testclient.TestClient", "os.environ.get", "monkeypatch.delenv", "client.get", "client.post", "client.get", "patch"], "search-terms": ["test_backend_api", "pytest", "FastAPI", "session", "chat", "history", "mock", "validation", "error handling"], "state": 2, "file_id": 12, "knowledge_revision": 29, "git_revision": "310eedd351f3ac34fdccc4ed65448d32dd019f20", "ctags": [{"_type": "tag", "name": "DummyAIClient", "path": "/home/kavia/workspace/code-generation/academic-query-assistant-186377-186387/study_assistant_backend/tests/test_backend_api.py", "pattern": "/^    class DummyAIClient:$/", "file": true, "language": "Python", "kind": "class", "scope": "test_openai_error_results_in_502", "scopeKind": "function"}, {"_type": "tag", "name": "chat", "path": "/home/kavia/workspace/code-generation/academic-query-assistant-186377-186387/study_assistant_backend/tests/test_backend_api.py", "pattern": "/^        def chat(self, messages, model: Optional[str] = None) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "member", "signature": "(self, messages, model: Optional[str] = None)", "scope": "test_openai_error_results_in_502.DummyAIClient", "scopeKind": "class"}, {"_type": "tag", "name": "client", "path": "/home/kavia/workspace/code-generation/academic-query-assistant-186377-186387/study_assistant_backend/tests/test_backend_api.py", "pattern": "/^def client() -> TestClient:$/", "language": "Python", "typeref": "typename:TestClient", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "force_mock_ai", "path": "/home/kavia/workspace/code-generation/academic-query-assistant-186377-186387/study_assistant_backend/tests/test_backend_api.py", "pattern": "/^def force_mock_ai(monkeypatch):$/", "language": "Python", "kind": "function", "signature": "(monkeypatch)"}, {"_type": "tag", "name": "test_chat_success_with_auto_created_session_and_mock_ai", "path": "/home/kavia/workspace/code-generation/academic-query-assistant-186377-186387/study_assistant_backend/tests/test_backend_api.py", "pattern": "/^def test_chat_success_with_auto_created_session_and_mock_ai(client: TestClient):$/", "language": "Python", "kind": "function", "signature": "(client: TestClient)"}, {"_type": "tag", "name": "test_chat_validation_errors", "path": "/home/kavia/workspace/code-generation/academic-query-assistant-186377-186387/study_assistant_backend/tests/test_backend_api.py", "pattern": "/^def test_chat_validation_errors(client: TestClient, question: str, expected_msg_fragment: str):$/", "language": "Python", "kind": "function", "signature": "(client: TestClient, question: str, expected_msg_fragment: str)"}, {"_type": "tag", "name": "test_health_check_ok", "path": "/home/kavia/workspace/code-generation/academic-query-assistant-186377-186387/study_assistant_backend/tests/test_backend_api.py", "pattern": "/^def test_health_check_ok(client: TestClient):$/", "language": "Python", "kind": "function", "signature": "(client: TestClient)"}, {"_type": "tag", "name": "test_history_returns_messages_for_session", "path": "/home/kavia/workspace/code-generation/academic-query-assistant-186377-186387/study_assistant_backend/tests/test_backend_api.py", "pattern": "/^def test_history_returns_messages_for_session(client: TestClient):$/", "language": "Python", "kind": "function", "signature": "(client: TestClient)"}, {"_type": "tag", "name": "test_openai_error_results_in_502", "path": "/home/kavia/workspace/code-generation/academic-query-assistant-186377-186387/study_assistant_backend/tests/test_backend_api.py", "pattern": "/^def test_openai_error_results_in_502(client: TestClient):$/", "language": "Python", "kind": "function", "signature": "(client: TestClient)"}, {"_type": "tag", "name": "test_session_get_returns_uuid", "path": "/home/kavia/workspace/code-generation/academic-query-assistant-186377-186387/study_assistant_backend/tests/test_backend_api.py", "pattern": "/^def test_session_get_returns_uuid(client: TestClient):$/", "language": "Python", "kind": "function", "signature": "(client: TestClient)"}], "hash": "4c622104811373da37e2e08f4a87c266", "format-version": 4, "code-base-name": "study_assistant_backend", "filename": "study_assistant_backend/tests/test_backend_api.py", "revision_history": [{"29": "310eedd351f3ac34fdccc4ed65448d32dd019f20"}]}